{{if eq (len .Trackers) 0}}
<div class="empty-state">
    <h2>No trackers found</h2>
    <p>Try a different filter, or add your first source entry.</p>
</div>
{{else}}
{{if gt .TotalPages 1}}
<div class="pagination pagination--top">
    <p class="pagination-results">{{.TotalResults}} result{{if ne .TotalResults 1}}s{{end}}</p>
    <div class="pagination__group" role="navigation" aria-label="Pagination">
        <button type="button"
                class="pagination-btn js-page-btn"
                data-page-value="{{.PrevPage}}"
                {{if not .HasPrevPage}}disabled{{end}}>
            &#8249;
        </button>

        {{range .PageNumbers}}
        {{if eq . 0}}
        <span class="pagination-ellipsis" aria-hidden="true">&hellip;</span>
        {{else}}
        <button type="button"
                class="pagination-btn {{if eq . $.Page}}pagination-btn--active {{end}}js-page-btn"
                data-page-value="{{.}}"
                {{if eq . $.Page}}aria-current="page"{{end}}>
            {{.}}
        </button>
        {{end}}
        {{end}}

        <button type="button"
                class="pagination-btn js-page-btn"
                data-page-value="{{.NextPage}}"
                {{if not .HasNextPage}}disabled{{end}}>
            &#8250;
        </button>
    </div>
    <div class="pagination-site-links" aria-label="Connector websites">
        {{range .SiteLinks}}
        <a class="pagination-site-link{{if not .LogoURL}} pagination-site-link--text{{end}}"
           href="{{.HomeURL}}"
           target="_blank"
           rel="noopener noreferrer"
           title="{{.Name}}">
            {{if .LogoURL}}
            <img src="{{.LogoURL}}" alt="{{.Name}}">
            {{else}}
            <span class="pagination-site-link__text">{{.Name}}</span>
            {{end}}
        </a>
        {{end}}
    </div>
</div>
{{end}}

{{if eq .ViewMode "list"}}
<div id="cards-container-list" class="cards-list">
    {{range .Trackers}}
    {{template "tracker_card_list" .}}
    {{end}}
</div>
{{else}}
<div id="cards-container-grid" class="cards-grid">
    {{range .Trackers}}
    {{template "tracker_card_grid" .}}
    {{end}}
</div>
{{end}}

{{if gt .TotalPages 1}}
<div class="pagination pagination--bottom">
    <div class="pagination__group" role="navigation" aria-label="Pagination">
        <button type="button"
                class="pagination-btn js-page-btn"
                data-page-value="{{.PrevPage}}"
                {{if not .HasPrevPage}}disabled{{end}}>
            &#8249;
        </button>

        {{range .PageNumbers}}
        {{if eq . 0}}
        <span class="pagination-ellipsis" aria-hidden="true">&hellip;</span>
        {{else}}
        <button type="button"
                class="pagination-btn {{if eq . $.Page}}pagination-btn--active {{end}}js-page-btn"
                data-page-value="{{.}}"
                {{if eq . $.Page}}aria-current="page"{{end}}>
            {{.}}
        </button>
        {{end}}
        {{end}}

        <button type="button"
                class="pagination-btn js-page-btn"
                data-page-value="{{.NextPage}}"
                {{if not .HasNextPage}}disabled{{end}}>
            &#8250;
        </button>
    </div>
</div>
{{end}}
{{end}}

{{if .PendingCovers}}
<script>
    (function () {
        if (window.__freezeTrackersOrder && window.__pinnedTrackerID) {
            var pinnedContainer = document.getElementById('cards-container-list') || document.getElementById('cards-container-grid');
            var pinnedCard = document.getElementById(window.__pinnedTrackerID);
            if (pinnedContainer && pinnedCard) {
                if (pinnedContainer.firstElementChild !== pinnedCard) {
                    pinnedContainer.insertBefore(pinnedCard, pinnedContainer.firstElementChild);
                }
                pinnedCard.style.order = '-9999';
            }
        }

        var refreshKey = "{{.RefreshKey}}";
        if (!refreshKey || !document || !document.body) {
            return;
        }
        if (window.__freezeTrackersOrder) {
            return;
        }

        if (window.__pendingTrackersRefreshTimer) {
            window.clearTimeout(window.__pendingTrackersRefreshTimer);
            window.__pendingTrackersRefreshTimer = null;
        }

        if (!window.__coverRefreshAttempts) {
            window.__coverRefreshAttempts = {};
        }

        var attempts = Number(window.__coverRefreshAttempts[refreshKey] || 0);
        var maxAttempts = 30;
        if (attempts >= maxAttempts) {
            return;
        }

        window.__coverRefreshAttempts[refreshKey] = attempts + 1;
        var delayMs = Math.min(3000, 600 + (attempts * 200));
        window.__pendingTrackersRefreshTimer = window.setTimeout(function () {
            window.__pendingTrackersRefreshTimer = null;
            if (window.__freezeTrackersOrder) {
                return;
            }
            window.__silentCoverRefresh = true;
            document.body.dispatchEvent(new Event('trackersChanged'));
        }, delayMs);
    })();
</script>
{{else}}
<script>
    (function () {
        if (window.__freezeTrackersOrder && window.__pinnedTrackerID) {
            var pinnedContainer = document.getElementById('cards-container-list') || document.getElementById('cards-container-grid');
            var pinnedCard = document.getElementById(window.__pinnedTrackerID);
            if (pinnedContainer && pinnedCard) {
                if (pinnedContainer.firstElementChild !== pinnedCard) {
                    pinnedContainer.insertBefore(pinnedCard, pinnedContainer.firstElementChild);
                }
                pinnedCard.style.order = '-9999';
            }
        }

        if (window.__pendingTrackersRefreshTimer) {
            window.clearTimeout(window.__pendingTrackersRefreshTimer);
            window.__pendingTrackersRefreshTimer = null;
        }

        var refreshKey = "{{.RefreshKey}}";
        if (!refreshKey || !window.__coverRefreshAttempts) {
            return;
        }
        delete window.__coverRefreshAttempts[refreshKey];
    })();
</script>
{{end}}
