{{if eq (len .Trackers) 0}}
<div class="empty-state">
    <h2>No trackers found</h2>
    <p>Try a different filter, or add your first source entry.</p>
</div>
{{else}}
{{if eq .ViewMode "list"}}
<div id="cards-container-list" class="cards-list">
    {{range .Trackers}}
    {{template "tracker_card_list" .}}
    {{end}}
</div>
{{else}}
<div id="cards-container-grid" class="cards-grid">
    {{range .Trackers}}
    {{template "tracker_card_grid" .}}
    {{end}}
</div>
{{end}}

{{if gt .TotalPages 1}}
<div class="pagination" style="margin-top:16px;">
    <div class="pagination__group" role="navigation" aria-label="Pagination">
        <button type="button"
                class="pagination-btn js-page-btn"
                data-page-value="{{.PrevPage}}"
                {{if not .HasPrevPage}}disabled{{end}}>
            &#8249;
        </button>

        {{range .PageNumbers}}
        {{if eq . 0}}
        <span class="pagination-ellipsis" aria-hidden="true">&hellip;</span>
        {{else}}
        <button type="button"
                class="pagination-btn {{if eq . $.Page}}pagination-btn--active {{end}}js-page-btn"
                data-page-value="{{.}}"
                {{if eq . $.Page}}aria-current="page"{{end}}>
            {{.}}
        </button>
        {{end}}
        {{end}}

        <button type="button"
                class="pagination-btn js-page-btn"
                data-page-value="{{.NextPage}}"
                {{if not .HasNextPage}}disabled{{end}}>
            &#8250;
        </button>
    </div>
</div>
{{end}}
{{end}}

{{if .PendingCovers}}
<script>
    (function () {
        var refreshKey = "{{.RefreshKey}}";
        if (!refreshKey || !document || !document.body) {
            return;
        }

        if (!window.__coverRefreshAttempts) {
            window.__coverRefreshAttempts = {};
        }

        var attempts = Number(window.__coverRefreshAttempts[refreshKey] || 0);
        var maxAttempts = 30;
        if (attempts >= maxAttempts) {
            return;
        }

        window.__coverRefreshAttempts[refreshKey] = attempts + 1;
        var delayMs = Math.min(3000, 600 + (attempts * 200));
        window.setTimeout(function () {
            window.__silentCoverRefresh = true;
            document.body.dispatchEvent(new Event('trackersChanged'));
        }, delayMs);
    })();
</script>
{{else}}
<script>
    (function () {
        var refreshKey = "{{.RefreshKey}}";
        if (!refreshKey || !window.__coverRefreshAttempts) {
            return;
        }
        delete window.__coverRefreshAttempts[refreshKey];
    })();
</script>
{{end}}
