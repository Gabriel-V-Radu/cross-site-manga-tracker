<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Cross-Site Tracker â€” Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda:opsz,wght@6..96,500;6..96,700&family=IBM+Plex+Sans+Condensed:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/svg+xml" href="/assets/favicon.svg">
    <link rel="stylesheet" href="/assets/dashboard.css">
    <script src="https://unpkg.com/htmx.org@1.9.12" defer></script>
    <script src="/assets/dashboard-core.js" defer></script>
    <script src="/assets/dashboard-trackers.js" defer></script>
    <script src="/assets/dashboard-linked-sources.js" defer></script>
    <script src="/assets/dashboard-tags.js" defer></script>
</head>

<body>
    <div class="grain"></div>
    <main class="shell">
        <header class="masthead">
            <div class="masthead__copy">
                <p class="kicker">Cross-Site Tracker</p>
                <h1>Editorial Control Room</h1>
                <p class="subtitle">Track updates across sources with sharp filters, fast edits, and a focused reading queue.</p>
            </div>
            <div class="profile-toolbar" id="profile-rename-form">
                <label class="profile-toolbar__label profile-toolbar__label--profile">
                    Active Profile
                    <input type="text" value="{{.ActiveProfile.Name}}" readonly>
                </label>
                <button type="button"
                        class="action-btn action-btn--accent"
                        hx-get="/dashboard/profile/menu"
                        hx-target="#modal-zone"
                        hx-swap="innerHTML">Menu</button>
            </div>
        </header>

        <section class="control-panel">
            <form id="tracker-filters"
                  hx-get="/dashboard/trackers"
                  hx-target="#trackers-zone"
                  hx-trigger="load, trackersChanged from:body"
                  class="filters-grid">
                <label>
                    Search
                    <span class="search-input-wrap">
                        <input type="text" id="dashboard-search-input" name="q" placeholder="Title">
                        <button type="button"
                                id="dashboard-search-clear"
                                class="search-clear-btn"
                                hidden
                                aria-label="Clear search">x</button>
                    </span>
                </label>
                <label>
                    Status
                    <select name="status">
                        {{range .Statuses}}
                        <option value="{{.}}" title="{{statusLabel .}}" {{if eq . "reading"}}selected{{end}}>{{statusLabel .}}</option>
                        {{end}}
                    </select>
                </label>
                <label>
                    Sort
                    <select name="sort">
                        {{range .Sorts}}
                        <option value="{{.}}" title="{{sortLabel .}}">{{sortLabel .}}</option>
                        {{end}}
                    </select>
                </label>
                <label>
                    Linked Sites
                    <details id="filter-sites-dropdown" class="filter-multi-select">
                        <summary id="filter-sites-summary">0</summary>
                        <div class="filter-multi-select__menu filter-multi-select__menu--sites"
                             hx-get="/dashboard/profile/filter-linked-sites"
                             hx-trigger="load, trackersChanged from:body"
                             hx-target="this"
                             hx-swap="innerHTML"
                             hx-include="#profile-filter, #tracker-filters input[name='sites']:checked">
                            {{if gt (len .LinkedSites) 0}}
                            {{range .LinkedSites}}
                            <label class="filter-multi-select__option">
                                <input type="checkbox" name="sites" value="{{.ID}}" {{if index $.SelectedLinkedSiteIDs .ID}}checked{{end}}>
                                <span>{{.Name}}</span>
                            </label>
                            {{end}}
                            {{else}}
                            <p class="filter-multi-select__empty">No linked sites yet.</p>
                            {{end}}
                        </div>
                    </details>
                </label>
                <label class="filters-grid__tags-row">
                    Tags
                    <details id="filter-tags-dropdown" class="filter-multi-select">
                        <summary id="filter-tags-summary">0</summary>
                        <div class="filter-multi-select__menu"
                             hx-get="/dashboard/profile/filter-tags"
                             hx-trigger="load, profileTagsChanged from:body"
                             hx-target="this"
                             hx-swap="innerHTML"
                             hx-include="#profile-filter">
                            {{if gt (len .ProfileTags) 0}}
                            {{range .ProfileTags}}
                            <label class="filter-multi-select__option">
                                <input type="checkbox" name="tags" value="{{.Name}}">
                                <span>{{.Name}}</span>
                            </label>
                            {{end}}
                            {{else}}
                            <p class="filter-multi-select__empty">No tags created yet.</p>
                            {{end}}
                        </div>
                    </details>
                </label>
                <input type="hidden" name="profile" id="profile-filter" value="{{.ActiveProfile.Key}}">
                <input type="hidden" name="view" id="view-input" value="grid">
                <input type="hidden" name="page" id="page-input" value="1">
            </form>

            <div class="panel-actions">
                <div class="view-toggle" role="group" aria-label="Tracker view mode">
                    <button type="button"
                            class="view-toggle__option"
                            data-view-mode="grid"
                            aria-pressed="true">
                        Grid
                    </button>
                    <button type="button"
                            class="view-toggle__option"
                            data-view-mode="list"
                            aria-pressed="false">
                        List
                    </button>
                </div>
                <button type="button"
                        class="action-btn action-btn--accent"
                        hx-get="/dashboard/trackers/new"
                        hx-vals='js:{view: (document.getElementById("view-input") && document.getElementById("view-input").value) ? document.getElementById("view-input").value : "grid"}'
                        hx-target="#modal-zone"
                        hx-swap="innerHTML">
                    + Add Tracker
                </button>
            </div>
        </section>

        <section id="trackers-zone" class="trackers-zone"></section>
    </main>

    <div id="modal-zone"></div>
</body>

</html>
